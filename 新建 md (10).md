$$
\begin{aligned}
% 阶段1: 基础特征提取（保持原GCN结构）
\mathring{H}^{(1)} &= \text{ReLU}(\tilde{A}XW^{(0)}) \\
H^{(1)}_{\text{out}} &= \mathring{H}^{(1)} \quad \text{（首层不融合）} \\
\mathring{H}^{(2)} &= \text{ReLU}(\tilde{A}H^{(1)}_{\text{out}}W^{(1)}) \\
\mathring{H}^{(3)} &= \text{ReLU}(\tilde{A}H^{(2)}_{\text{out}}W^{(2)}) \\
\mathring{H}^{(4)} &= \text{ReLU}(\tilde{A}H^{(3)}_{\text{out}}W^{(3)}) \\
\mathring{H}^{(5)} &= \text{ReLU}(\tilde{A}H^{(4)}_{\text{out}}W^{(4)}) \\

% 阶段2: BiFPN特征融合（修正核心错误）
% ========== BiFPN Block 1 ==========
% 自上而下路径（TD Path）
H^{(5)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(5)}\mathring{H}^{(5)} + w_2^{(5)}\varnothing}{w_1^{(5)} + \epsilon}\right) \quad \text{（顶层无上层输入）} \\
H^{(4)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(4)}\mathring{H}^{(4)} + w_2^{(4)}\text{Resize}(H^{(5)}_{td})}{w_1^{(4)} + w_2^{(4)} + \epsilon}\right) \\
H^{(3)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(3)}\mathring{H}^{(3)} + w_2^{(3)}\text{Resize}(H^{(4)}_{td})}{w_1^{(3)} + w_2^{(3)} + \epsilon}\right) \\
H^{(2)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(2)}\mathring{H}^{(2)} + w_2^{(2)}\text{Resize}(H^{(3)}_{td})}{w_1^{(2)} + w_2^{(2)} + \epsilon}\right) \\
H^{(1)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(1)}\mathring{H}^{(1)} + w_2^{(1)}\text{Resize}(H^{(2)}_{td})}{w_1^{(1)} + w_2^{(1)} + \epsilon}\right) \\

% 自下而上路径（BU Path）
H^{(1)}_{bu} &= \text{DepthwiseConv}\left(\frac{w_1^{'(1)}H^{(1)}_{td} + w_2^{'(1)}\varnothing}{w_1^{'(1)} + \epsilon}\right) \quad \text{（底层无下层输入）} \\
H^{(2)}_{bu} &= \text{DepthwiseConv}\left(\frac{w_1^{'(2)}H^{(2)}_{td} + w_2^{'(2)}\text{Resize}(H^{(1)}_{bu})}{w_1^{'(2)} + w_2^{'(2)} + \epsilon}\right) \\
H^{(3)}_{bu} &= \text{DepthwiseConv}\left(\frac{w_1^{'(3)}H^{(3)}_{td} + w_2^{'(3)}\text{Resize}(H^{(2)}_{bu})}{w_1^{'(3)} + w_2^{'(3)} + \epsilon}\right) \\
H^{(4)}_{bu} &= \text{DepthwiseConv}\left(\frac{w_1^{'(4)}H^{(4)}_{td} + w_2^{'(4)}\text{Resize}(H^{(3)}_{bu})}{w_1^{'(4)} + w_2^{'(4)} + \epsilon}\right) \\
H^{(5)}_{bu} &= \text{DepthwiseConv}\left(\frac{w_1^{'(5)}H^{(5)}_{td} + w_2^{'(5)}\text{Resize}(H^{(4)}_{bu})}{w_1^{'(5)} + w_2^{'(5)} + \epsilon}\right) \\

% ========== BiFPN Block 2 ==========
% 使用Block1的输出作为Block2的输入（体现Repeated Blocks）
H^{(5)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(5)}H^{(5)}_{bu} + w_2^{(5)}\varnothing}{w_1^{(5)} + \epsilon}\right) \quad \text{（跨块连接）} \\
H^{(4)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(4)}H^{(4)}_{bu} + w_2^{(4)}\text{Resize}(H^{(5)}_{td})}{w_1^{(4)} + w_2^{(4)} + \epsilon}\right) \\
&\vdots \quad \text{（重复Block1的相同操作）} \\

% 最终输出（对应论文中的重复次数D_bifpn=2）
H^{(1)}_{\text{out}} &= H^{(1)}_{bu} \quad \text{（底层最终输出）} \\
H^{(2)}_{\text{out}} &= H^{(2)}_{bu} \\
H^{(3)}_{\text{out}} &= H^{(3)}_{bu} \\
H^{(4)}_{\text{out}} &= H^{(4)}_{bu} \\
H^{(5)}_{\text{out}} &= H^{(5)}_{bu} \quad \text{（顶层最终输出）}
\end{aligned}
$$


---
Repet Block 1
    - 自上而下路径（TD Path）
    $$
    \begin{aligned}
H^{(5)}_{\text{td}} &= \text{Pass} \quad \text{（顶层无上层输入）} \\
H^{(4)}_{\text{td}} &= \text{DepthwiseConv}\left(\frac{w_1^{(4)}\mathring{H}^{(4)} + w_2^{(4)}\text{Resize}(\mathring H^{(5)})}{w_1^{(4)} + w_2^{(4)} + \epsilon}\right) \\
&\vdots \quad \text{2, 3 层重复此操作}\\
H^{(1)}_{\text{bu}} &= \text{DepthwiseConv}\left(\frac{w_1^{(1)}\mathring{H}^{(1)} + w_2^{(1)}\text{Resize}(H^{(2)}_{\text{td}})}{w_1^{(1)} + w_2^{(1)} + \epsilon}\right)  \quad \text{（底层无下层输出对象）} \\
    \end{aligned}
    $$
    - 自下而上路径（BU Path） % 缺少了跳跃连接
    $$
    \begin{aligned}
H^{(1)}_{\text{bu}} &= \text{DepthwiseConv}\left(\frac{w_1^{(1)}\mathring{H}^{(1)} + w_2^{(1)}\text{Resize}(H^{(2)}_{\text{td}})}{w_1^{(1)} + w_2^{(1)} + \epsilon}\right) \quad \text{（底层无下层输入）} \\
H^{(2)}_{bu} &= \text{DepthwiseConv}\left(\frac{w_1^{'(2)}H^{(2)}_{td} + w_2^{'(2)}\text{Resize}(H^{(1)}_{bu})}{w_1^{'(2)} + w_2^{'(2)} + \epsilon}\right) \\
&\vdots \quad \text{3, 4 层重复此操作}\\
H^{(5)}_{bu} &= \text{DepthwiseConv}\left(\frac{w_1^{'(5)}\mathring{H}^{(5)} + w_2^{'(5)}\text{Resize}(H^{(4)}_{bu})}{w_1^{'(5)} + w_2^{'(5)} + \epsilon}\right) \\
    \end{aligned}
    $$


Repeat Block2
    - 自上而下路径（TD Path）
    $$
    \begin{aligned}
H^{(5)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(5)}H^{(5)}_{bu} + w_2^{(5)}\varnothing}{w_1^{(5)} + \epsilon}\right) \quad \text{（跨块连接）} \\
H^{(4)}_{td} &= \text{DepthwiseConv}\left(\frac{w_1^{(4)}H^{(4)}_{bu} + w_2^{(4)}\text{Resize}(H^{(5)}_{td})}{w_1^{(4)} + w_2^{(4)} + \epsilon}\right) \\
&\vdots \quad \text{（使用Block1的输出作为Block2的输入 | 2, 3 层重复此操作）} \\
H^{(1)}_{\text{td}} &= \text{DepthwiseConv}\left(\frac{w_1^{(1)}{H}^{(1)_{bu}} + w_2^{(1)}\text{Resize}(H^{(2)}_{\text{td}})}{w_1^{(1)} + w_2^{(1)} + \epsilon}\right) \\
    \end{aligned}
    $$
- 自下而上路径（BU Path）% 补充跳跃连接后
    $$
    \begin{aligned}
H^{(1)}_{\text{bu}} &= \text{DepthwiseConv}\left(\frac{w_1^{'(1)}H^{(1)}_{\text{td}} + w_2^{'(1)}\mathring{H}^{(1)} }{w_1^{'(1)} + w_2^{'(1)} + \epsilon}\right) \quad \text{（底层无下层输入）} \\
H^{(2)}_{\text{bu}} &= \text{DepthwiseConv}\left(\frac{w_1^{'(2)}H^{(2)}_{\text{td}} + w_2^{'(2)}\mathring{H}^{(2)} + w_3^{'(2)}\text{Resize}(H^{(1)}_{\text{bu}})}{w_1^{'(2)} + w_2^{'(2)} + w_3^{'(2)} + \epsilon}\right) \\
&\vdots \quad \text{3, 4 层重复此操作}\\
H^{(5)}_{\text{bu}} &= \text{DepthwiseConv}\left(\frac{w_1^{'(5)}H^{(5)}_{\text{td}} + w_2^{'(5)}\mathring{H}^{(5)} + w_3^{'(5)}\text{Resize}(H^{(4)}_{\text{bu}})}{w_1^{'(5)} + w_2^{'(5)} + w_3^{'(5)} + \epsilon}\right) \\
    \end{aligned}
    $$