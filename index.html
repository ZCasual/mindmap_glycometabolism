<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代谢路径图</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            background-color: #1e1e1e;
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        #graph {
            width: 100%;
            height: 600px;
            background-color: #1e1e1e;
            border-radius: 8px;
        }

        .node circle {
            stroke: #3d3d3d;
            stroke-width: 2px;
        }

        .node.primary circle {
            fill: #2d2d2d;
        }

        .node.secondary circle {
            fill: #252525;
        }

        .node text {
            fill: #d4d4d4;
            text-anchor: middle;
            font-size: 14px;
        }

        .link {
            stroke: #4a4a4a;
            stroke-width: 2px;
        }

        .arrow {
            fill: #4a4a4a;
        }

        #info-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 0;
            height: 100vh;
            background-color: #2d2d2d;
            overflow-y: auto;
            transition: width 0.3s ease;
            padding: 0;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.3);
        }

        #info-panel.active {
            width: 40%;
            padding: 20px;
        }

        #info-panel-content {
            color: #d4d4d4;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #info-panel.active #info-panel-content {
            opacity: 1;
        }

        #info-panel h1 {
            color: #fff;
            border-bottom: 2px solid #4a4a4a;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #info-panel h3 {
            color: #2196F3;
            margin-top: 25px;
        }

        #info-panel h4 {
            color: #4CAF50;
            margin-top: 20px;
        }

        #info-panel ul, #info-panel ol {
            padding-left: 20px;
        }

        #info-panel li {
            margin-bottom: 8px;
        }

        #close-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        #close-panel:hover {
            color: #2196F3;
        }
    </style>

</head>
<body>
    <div id="graph"></div>
    <div id="info-panel">
        <button id="close-panel">&times;</button>
        <div id="info-panel-content"></div>
    </div>
    <script>
        const data = {
            nodes: [
                { id: "Glucose", label: "葡萄糖", group: "EMP" },
                { id: "Glycogenesis", label: "Glycogenesis", group: "Glycogenesis" },
                { id: "EMP", label: "EMP", group: "EMP" },
                { id: "PPP", label: "PPP", group: "PPP" },
                { id: "TCA", label: "TCA", group: "TCA" },
                { id: "GS", label: "GS", group: "GS" },
                { id: "GNG", label: "GNG", group: "GNG" },
                { id: "AcetylCoA", label: "乙酰辅酶A", group: "TCA" },
                { id: "Citrate", label: "柠檬酸", group: "TCA" },
                { id: "Aconitate", label: "顺乌头酸", group: "TCA" },
                { id: "Isocitrate", label: "异柠檬酸", group: "TCA" },
                { id: "αKG", label: "α-酮戊二酸", group: "TCA" },
                { id: "SuccinylCoA", label: "琥珀酰辅酶A", group: "TCA" },
                { id: "Succinate", label: "琥珀酸", group: "TCA" },
                { id: "Fumarate", label: "延胡索酸", group: "TCA" },
                { id: "Malate", label: "苹果酸", group: "TCA" },
                { id: "OAA", label: "草酰乙酸", group: "TCA" },
                { id: "Glucose-6-Phosphate", label: "葡萄糖-6-磷酸", group: "EMP" },
                { id: "Fructose-6-Phosphate", label: "果糖-6-磷酸", group: "EMP" },
                { id: "Fructose-1,6-bisphosphate", label: "果糖-1,6-二磷酸", group: "EMP" },
                { id: "Glyceraldehyde-3-Phosphate", label: "甘油醛-3-磷酸", group: "EMP" },
                { id: "Dihydroxyacetone Phosphate", label: "二羟基丙酮磷酸", group: "EMP" },
                { id: "1,3-Bisphosphoglycerate", label: "1,3-二磷酸甘油酸", group: "EMP" },
                { id: "3-Phosphoglycerate", label: "3-磷酸甘油酸", group: "EMP" },
                { id: "2-Phosphoglycerate", label: "2-磷酸甘油酸", group: "EMP" },
                { id: "Phosphoenolpyruvate", label: "���酸烯醇式丙酮酸", group: "EMP" },
                { id: "Pyruvate", label: "丙酮酸", group: "EMP" },
                { id: "6-Phosphoglucono-δ-lactone", label: "6-磷酸葡糖酸内酯", group: "PPP" },
                { id: "6-Phosphogluconate", label: "6-磷酸葡糖酸", group: "PPP" },
                { id: "Ribulose-5-Phosphate", label: "核酮糖-5-磷酸", group: "PPP" },
                { id: "Ribose-5-Phosphate", label: "核糖-5-磷酸", group: "PPP" },
                { id: "Erythrose-4-Phosphate", label: "赤藓糖-4-磷酸", group: "PPP" },
                { id: "Sedoheptulose-7-Phosphate", label: "景天庚酮糖-7-磷酸", group: "PPP" },
                { id: "OxaloacetateCyt", label: "胞质草酰乙酸", group: "GNG" },
                { id: "PEPCyt", label: "胞质磷酸烯醇式丙酮酸", group: "GNG" },
                { id: "PyruvateCyt", label: "胞质丙酮酸", group: "GNG" },
                { id: "Glucose1P", label: "葡萄糖-1-磷酸", group: "Glycogenesis" },
                { id: "UDPGlucose", label: "UDP-葡萄糖", group: "Glycogenesis" },
                { id: "LinearGlycogen", label: "线性糖原", group: "Glycogenesis" },
                { id: "BranchedGlycogen", label: "分支糖原", group: "Glycogenesis" },
                { id: "Glycogen", label: "糖原", group: "Glycogenesis" }
            ],
            links: [
                { source: "GS", target: "EMP", double: false },
                { source: "Glycogenesis", target: "EMP", double: true },
                { source: "EMP", target: "TCA", double: false },
                { source: "TCA", target: "PPP", double: false },
                { source: "EMP", target: "GNG", double: true },
                { source: "GS", target: "GS", double: false },
                { source: "AcetylCoA", target: "OAA", double: false },
                { source: "OAA", target: "Citrate", double: false },
                { source: "Citrate", target: "Aconitate", double: true },
                { source: "Aconitate", target: "Isocitrate", double: true },
                { source: "Isocitrate", target: "αKG", double: false },
                { source: "αKG", target: "SuccinylCoA", double: false },
                { source: "SuccinylCoA", target: "Succinate", double: false },
                { source: "Succinate", target: "Fumarate", double: true },
                { source: "Fumarate", target: "Malate", double: true },
                { source: "Malate", target: "OAA", double: true },
                { source: "Glucose", target: "Glucose-6-Phosphate", double: false },
                { source: "Glucose-6-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "Fructose-6-Phosphate", target: "Fructose-1,6-bisphosphate", double: false },
                { source: "Fructose-1,6-bisphosphate", target: "Glyceraldehyde-3-Phosphate", double: true },
                { source: "Fructose-1,6-bisphosphate", target: "Dihydroxyacetone Phosphate", double: true },
                { source: "Dihydroxyacetone Phosphate", target: "Glyceraldehyde-3-Phosphate", double: true },
                { source: "Glyceraldehyde-3-Phosphate", target: "1,3-Bisphosphoglycerate", double: true },
                { source: "1,3-Bisphosphoglycerate", target: "3-Phosphoglycerate", double: true },
                { source: "3-Phosphoglycerate", target: "2-Phosphoglycerate", double: true },
                { source: "2-Phosphoglycerate", target: "Phosphoenolpyruvate", double: true },
                { source: "Phosphoenolpyruvate", target: "Pyruvate", double: false },
                { source: "Glucose-6-Phosphate", target: "6-Phosphoglucono-δ-lactone", double: false },
                { source: "6-Phosphoglucono-δ-lactone", target: "6-Phosphogluconate", double: false },
                { source: "6-Phosphogluconate", target: "Ribulose-5-Phosphate", double: false },
                { source: "Ribulose-5-Phosphate", target: "Ribose-5-Phosphate", double: true },
                { source: "Ribulose-5-Phosphate", target: "Erythrose-4-Phosphate", double: true },
                { source: "Ribose-5-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "Erythrose-4-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "Erythrose-4-Phosphate", target: "Sedoheptulose-7-Phosphate", double: true },
                { source: "Sedoheptulose-7-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "PyruvateCyt", target: "OxaloacetateCyt", double: false },
                { source: "OxaloacetateCyt", target: "PEPCyt", double: false },
                { source: "PEPCyt", target: "Phosphoenolpyruvate", double: true },
                { source: "Pyruvate", target: "PyruvateCyt", double: true },
                { source: "Glucose-6-Phosphate", target: "Glucose1P", double: true },
                { source: "Glucose1P", target: "UDPGlucose", double: false },
                { source: "UDPGlucose", target: "LinearGlycogen", double: false },
                { source: "LinearGlycogen", target: "BranchedGlycogen", double: true },
                { source: "BranchedGlycogen", target: "Glycogen", double: false },
                { source: "Pyruvate", target: "AcetylCoA", double: false }
            ]
        };

        const width = document.getElementById('graph').clientWidth;
        const height = document.getElementById('graph').clientHeight;

        const svg = d3.select("#graph")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const g = svg.append("g");

        // 添加缩放功能
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // 添加颜色比例尺
        const color = d3.scaleOrdinal()
            .domain(["EMP", "TCA", "PPP", "GS", "GNG", "Glycogenesis"])
            .range(["#4CAF50", "#FF5722", "#2196F3", "#9C27B0", "#FFC107", "#FF1493"]);

        // 定义箭头
        const defs = g.append("defs");
        
        // 定义箭头标记
        defs.append("marker")
            .attr("id", "arrow")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 10)  // 保持您的refX值
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("class", "arrow");

        // 创建连接线
        const link = g.append("g")
            .selectAll("line")
            .data(data.links)
            .join("line")
            .attr("class", "link")
            .attr("marker-end", "url(#arrow)")
            .style("stroke", "#4a4a4a")
            .style("stroke-width", "2px");

        // 为双向连接添加反向线段
        const doubleLink = g.append("g")
            .selectAll("line")
            .data(data.links.filter(d => d.double))
            .join("line")
            .attr("class", "link")
            .attr("marker-end", "url(#arrow)")
            .style("stroke", "#4a4a4a")
            .style("stroke-width", "2px");

        // 添加关键酶和产物信息
        const linkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose" && d.target === "Glucose-6-Phosphate") {
                    return "[己糖激酶/葡萄糖激酶, ATP -> ADP]";
                } else if (d.source === "OAA" && d.target === "Citrate") {
                    return "[柠檬酸合酶, +H₂O]";
                } else if (d.source === "Citrate" && d.target === "Aconitate") {
                    return "[顺乌头酸酶, -H₂O]";
                } else if (d.source === "Aconitate" && d.target === "Isocitrate") {
                    return "[顺乌头酸酶, +H₂O]";
                } else if (d.source === "Isocitrate" && d.target === "αKG") {
                    return "[异柠檬酸脱氢酶, CO₂, NAD⁺ -> NADH+H⁺]";
                } else if (d.source === "αKG" && d.target === "SuccinylCoA") {
                    return "[α-酮戊二酸脱氢酶复合体, CO₂, NAD⁺ -> NADH+H⁺]";
                } else if (d.source === "SuccinylCoA" && d.target === "Succinate") {
                    return "[琥珀酰辅酶A合成酶, GDP -> GTP]";
                } else if (d.source === "Succinate" && d.target === "Fumarate") {
                    return "[琥珀酸脱氢酶, FAD -> FADH₂]";
                } else if (d.source === "Fumarate" && d.target === "Malate") {
                    return "[延胡索酸酶, +H₂O]";
                } else if (d.source === "Malate" && d.target === "OAA") {
                    return "[苹果酸脱氢酶, NAD⁺ -> NADH+H⁺]";
                }
                return "";
            });

        // 添加关键酶和产物信息
        const empLinkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose-6-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[磷酸己糖异构酶]";
                } else if (d.source === "Fructose-6-Phosphate" && d.target === "Fructose-1,6-bisphosphate") {
                    return "[磷酸果糖激酶-1, ATP -> ADP]";
                } else if (d.source === "Fructose-1,6-bisphosphate" && d.target === "Glyceraldehyde-3-Phosphate") {
                    return "[醛缩酶]";
                } else if (d.source === "Dihydroxyacetone Phosphate" && d.target === "Glyceraldehyde-3-Phosphate") {
                    return "[磷酸三糖异构酶]";
                } else if (d.source === "Glyceraldehyde-3-Phosphate" && d.target === "1,3-Bisphosphoglycerate") {
                    return "[甘油醛-3-磷酸脱氢酶, NAD⁺ -> NADH+H⁺]";
                } else if (d.source === "1,3-Bisphosphoglycerate" && d.target === "3-Phosphoglycerate") {
                    return "[磷酸甘油酸激酶, ADP -> ATP]";
                } else if (d.source === "3-Phosphoglycerate" && d.target === "2-Phosphoglycerate") {
                    return "[磷酸甘油酸变位酶]";
                } else if (d.source === "2-Phosphoglycerate" && d.target === "Phosphoenolpyruvate") {
                    return "[烯醇化酶]";
                } else if (d.source === "Phosphoenolpyruvate" && d.target === "Pyruvate") {
                    return "[丙酮酸激酶, ADP -> ATP]";
                } else if (d.source === "Pyruvate" && d.target === "AcetylCoA") {
                    return "[丙酮酸脱氢酶复合体, NAD⁺ -> NADH+H⁺, CoA-SH -> CO₂]";
                }
                return "";
            });

        // 添加关键酶和产物信息
        const pppLinkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose-6-Phosphate" && d.target === "6-Phosphoglucono-δ-lactone") {
                    return "[葡萄糖-6-磷酸脱氢酶, NADP⁺ -> NADPH+H⁺]";
                } else if (d.source === "6-Phosphoglucono-δ-lactone" && d.target === "6-Phosphogluconate") {
                    return "[6-磷酸葡糖酸内酯酶]";
                } else if (d.source === "6-Phosphogluconate" && d.target === "Ribulose-5-Phosphate") {
                    return "[6-磷酸葡糖酸脱氢酶, NADP⁺ -> NADPH+CO₂]";
                } else if (d.source === "Ribulose-5-Phosphate" && d.target === "Ribose-5-Phosphate") {
                    return "[磷酸戊糖异构酶]";
                } else if (d.source === "Ribulose-5-Phosphate" && d.target === "Erythrose-4-Phosphate") {
                    return "[转酮醇酶]";
                } else if (d.source === "Ribose-5-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[转醛醇酶]";
                } else if (d.source === "Erythrose-4-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[转醛酶]";
                } else if (d.source === "Erythrose-4-Phosphate" && d.target === "Sedoheptulose-7-Phosphate") {
                    return "[转酮醇酶]";
                } else if (d.source === "Sedoheptulose-7-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[转醛醇酶]";
                }
                return "";
            });

        // 添加关键酶和产物信息
        const glycogenesisLinkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose" && d.target === "Glucose-6-Phosphate") {
                    return "[己糖激酶/葡萄糖激酶, ATP -> ADP]";
                } else if (d.source === "Glucose-6-Phosphate" && d.target === "Glucose1P") {
                    return "[磷酸葡萄糖变位酶]";
                } else if (d.source === "Glucose1P" && d.target === "UDPGlucose") {
                    return "[UDP-葡萄糖焦磷酸化酶, UTP -> PPi]";
                } else if (d.source === "UDPGlucose" && d.target === "LinearGlycogen") {
                    return "[糖原合成酶, UDP]";
                } else if (d.source === "LinearGlycogen" && d.target === "BranchedGlycogen") {
                    return "[糖原分支酶]";
                }
                return "";
            });

        // 创建节点
        const node = g.append("g")
            .selectAll(".node")
            .data(data.nodes)
            .join("g")
            .attr("class", d => `node ${d.type}`)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        node.append("circle")
            .attr("r", 30)
            .style("fill", d => color(d.group))
            .style("stroke", "#3d3d3d")
            .style("stroke-width", "2px");

        node.append("text")
            .text(d => d.label)
            .attr("dy", ".35em")
            .style("fill", "#FFFFFF");

        // 定义主要通路节点
        const mainPathways = ["EMP", "TCA", "PPP", "GS", "GNG", "Glycogenesis"];

        // 为节点添加点击事件
        node.on("click", (event, d) => {
            if (mainPathways.includes(d.id)) {
                handlePathwayClick(d.id);
            } else {
                // 点击其他节点时恢复所有元素显示
                resetPathwayDisplay();
            }
        });

        // 添加重置显示的函数
        function resetPathwayDisplay() {
            // 清除激活状态
            node.classed("active", false);
            
            // 恢复所有元素的完全显示
            node.style("opacity", 1);
            link.style("opacity", 1);
            doubleLink.style("opacity", 1);
            linkLabels.style("opacity", 1);
            empLinkLabels.style("opacity", 1);
            pppLinkLabels.style("opacity", 1);
            glycogenesisLinkLabels.style("opacity", 1);
        }

        // 力导向图配置
        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links)
                .id(d => d.id)
                .distance(200))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(50));

        // 更新位置
        simulation.on("tick", () => {
            link.attr("x1", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.x + (dx * 25) / dr;
            })
            .attr("y1", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.y + (dy * 25) / dr;
            })
            .attr("x2", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.x - (dx * 27) / dr;
            })
            .attr("y2", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.y - (dy * 27) / dr;
            });

            // 更新双向连接的反向线段
            doubleLink.attr("x1", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.x + (dx * 25) / dr;
            })
            .attr("y1", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.y + (dy * 25) / dr;
            })
            .attr("x2", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.x - (dx * 27) / dr;
            })
            .attr("y2", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.y - (dy * 27) / dr;
            });

            node.attr("transform", d => `translate(${d.x},${d.y})`);

            // 更新关键酶和产物信息的位置
            linkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                      .attr("y", d => (d.source.y + d.target.y) / 2);

            // 更新EMP途径的连接线标签位置
            empLinkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                         .attr("y", d => (d.source.y + d.target.y) / 2);

            // 更新PPP途径的连接线标签位置
            pppLinkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                         .attr("y", d => (d.source.y + d.target.y) / 2);

            // 更新糖异生途径的连接线标签位置
            glycogenesisLinkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                                 .attr("y", d => (d.source.y + d.target.y) / 2);
        });

        // 拖拽函数
        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        // 响应窗口大小变化
        window.addEventListener('resize', () => {
            const newWidth = document.getElementById('graph').clientWidth;
            const newHeight = document.getElementById('graph').clientHeight;
            
            svg.attr("width", newWidth)
               .attr("height", newHeight);
            
            simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2))
                     .restart();
        });

        const pathwayInfo = {
            "EMP": `
                <h1>EMP</h1>
                <h3>糖酵解途径（EMP途径）总结</h3>

                <h4>一、糖酵解的阶段</h4>
                <p>糖酵解可以分为两个主要阶段：</p>
                <ol>
                    <li><strong>准备阶段（耗能阶段）</strong>：
                        <ul>
                            <li>葡萄糖被激活并裂解为两个三碳分子（甘油醛-3-磷酸）</li>
                            <li>消耗2分子ATP</li>
                        </ul>
                    </li>
                    <li><strong>产能阶段</strong>：
                        <ul>
                            <li>每个三碳分子（甘油醛-3-磷酸）被氧化生成丙酮酸</li>
                            <li>生成4分子ATP和2分子NADH</li>
                        </ul>
                    </li>
                </ol>

                <h4>二、糖酵解的步骤</h4>
                <ol>
                    <li><strong>葡萄糖磷酸化</strong>：
                        <ul>
                            <li>葡萄糖 → 葡萄糖-6-磷酸（己糖激酶，消耗1 ATP）</li>
                        </ul>
                    </li>
                    <li><strong>葡萄糖-6-磷酸异构化</strong>：
                        <ul>
                            <li>葡萄糖-6-磷酸 → 果糖-6-磷酸（磷酸己糖异构酶）</li>
                        </ul>
                    </li>
                    <li><strong>果糖-6-磷酸磷酸化</strong>：
                        <ul>
                            <li>果糖-6-磷酸 → 果糖-1,6-二磷酸（磷酸果糖激酶-1，消耗1 ATP）</li>
                        </ul>
                    </li>
                    <li><strong>果糖-1,6-二磷酸裂解</strong>：
                        <ul>
                            <li>果糖-1,6-二磷酸 → 甘油醛-3-磷酸 + 二羟丙酮磷酸（醛缩酶）</li>
                        </ul>
                    </li>
                    <li><strong>二羟丙酮磷酸异构化</strong>：
                        <ul>
                            <li>二羟丙酮磷酸 → 甘油醛-3-磷酸（磷酸丙糖异构酶）</li>
                        </ul>
                    </li>
                    <li><strong>甘油醛-3-磷酸氧化</strong>：
                        <ul>
                            <li>甘油醛-3-磷酸 → 1,3-二磷酸甘油酸（甘油醛-3-磷酸脱氢酶，生成1 NADH）</li>
                        </ul>
                    </li>
                    <li><strong>1,3-二磷酸甘油酸转化为3-磷酸甘油酸</strong>：
                        <ul>
                            <li>1,3-二磷酸甘油酸 → 3-磷酸甘油酸（磷酸甘油酸激酶，生成1 ATP）</li>
                        </ul>
                    </li>
                    <li><strong>3-磷酸甘油酸异构化</strong>：
                        <ul>
                            <li>3-磷酸甘油酸 → 2-磷酸甘油酸（磷酸甘油酸变位酶）</li>
                        </ul>
                    </li>
                    <li><strong>2-磷酸甘油酸脱水</strong>：
                        <ul>
                            <li>2-磷酸甘油酸 → 磷酸烯醇式丙酮酸（烯醇化酶）</li>
                        </ul>
                    </li>
                    <li><strong>磷酸烯醇式丙酮酸转化为丙酮酸</strong>：
                        <ul>
                            <li>磷酸烯醇式丙酮酸 → 丙酮酸（丙酮酸激酶，生成1 ATP）</li>
                        </ul>
                    </li>
                </ol>

                <h4>三、能量平衡</h4>
                <ul>
                    <li><strong>总反应</strong>：
                        <ul>
                            <li>葡萄糖 + 2 NAD+ + 2 ADP + 2 Pi → 2 丙酮酸 + 2 ATP + 2 NADH + 2 H+ + 2 H2O</li>
                        </ul>
                    </li>
                    <li><strong>净生成</strong>：
                        <ul>
                            <li>每个葡萄糖分子通过糖酵解净生成 <strong>2 ATP</strong> 和 <strong>2 NADH</strong></li>
                        </ul>
                    </li>
                </ul>

                <h4>四、关键酶和调控</h4>
                <p>糖酵解的关键调控酶包括：</p>
                <ol>
                    <li><strong>己糖激酶</strong>：催化第一步反应，受葡萄糖-6-磷酸的负反馈抑制。</li>
                    <li><strong>磷酸果糖激酶-1（PFK-1）</strong>：糖酵解的主要限速酶，受ATP、AMP、柠檬酸和胰岛素等因素的调控。ATP抑制，AMP激活。</li>
                    <li><strong>丙酮酸激酶</strong>：催化最后一步反应，受ATP和丙氨酸的负反馈抑制，受胰岛素激活。</li>
                </ol>

                <h4>五、生理意义</h4>
                <ol>
                    <li><strong>提供能量</strong>：糖酵解是无氧条件下（如剧烈运动）生成ATP的重要途径。</li>
                    <li><strong>为其他代谢途径提供中间产物</strong>：糖酵解的中间产物可以进入其他代谢途径，如磷酸戊糖途径和甘油合成途径。</li>
                    <li><strong>为有氧呼吸做准备</strong>：在有氧条件下，糖酵解生成的丙酮酸进入线粒体，通过三羧酸循环和氧化磷酸化进一步生成ATP。</li>
                </ol>

                <h4>六、无氧条件下的发酵</h4>
                <p>在无氧条件下，细胞无法通过电子传递链氧化NADH，因此需要通过发酵过程将糖酵解产生的NADH重新氧化为NAD⁺，以维持���酵解的持续进行。</p>
                
                <h5>1. 乳酸发酵</h5>
                <ul>
                    <li><strong>反应过程</strong>：
                        <ul>
                            <li>丙酮酸 + NADH + H⁺ → 乳酸 + NAD⁺</li>
                            <li><strong>酶</strong>：乳酸脱氢酶（Lactate dehydrogenase）</li>
                        </ul>
                    </li>
                    <li><strong>举例</strong>：乳酸菌、骨骼肌细胞在无氧条件下会进行乳酸发酵。</li>
                    <li><strong>结果</strong>：乳酸是最终产物，积累过多会导致肌肉酸痛。</li>
                </ul>

                <h5>2. 酒精发酵</h5>
                <ul>
                    <li><strong>反应过程</strong>：
                        <ul>
                            <li>丙酮酸 → 乙醛 + CO₂（丙酮酸脱羧酶，需要TPP作为辅酶）</li>
                            <li>乙醛 + NADH + H⁺ → 乙醇 + NAD⁺（乙醇脱氢酶）</li>
                        </ul>
                    </li>
                    <li><strong>举例</strong>：酵母菌在无氧条件下进行酒精发酵。</li>
                    <li><strong>结果</strong>：乙醇和CO₂是最终产物，乙醇可以被��一步代谢或排出体外。</li>
                </ul>

                <h4>七、糖酵解的调控</h4>
                <p>糖酵解途径受到多层次的调控，以确保细胞的能量需求和代谢平衡。关键的调控点包括：</p>
                <ol>
                    <li><strong>己糖激酶</strong>：
                        <ul>
                            <li>催化糖酵解的第一步反应，将葡萄糖转化为葡萄糖-6-磷酸</li>
                            <li>受其产物葡萄糖-6-磷酸的负反馈抑制</li>
                        </ul>
                    </li>
                    <li><strong>磷酸果糖激酶-1（PFK-1）</strong>：
                        <ul>
                            <li>是糖酵解途径中最重要的限速酶，受多种因素的调控：</li>
                            <li><strong>ATP</strong>：高浓度ATP抑制PFK-1活性，AMP则激活PFK-1</li>
                            <li><strong>柠檬酸</strong>：作为TCA循环的中间产物，高浓度时抑制PFK-1</li>
                            <li><strong>胰岛素</strong>：通过信号通路激活PFK-1，促进糖酵解</li>
                        </ul>
                    </li>
                    <li><strong>丙酮酸激酶</strong>：
                        <ul>
                            <li>催化糖酵解的最后一步反应</li>
                            <li>受ATP的负反馈抑制</li>
                            <li>受胰岛素激活</li>
                        </ul>
                    </li>
                </ol>
            `,
            "PPP": `
                <h1>PPP</h1>
                <h3>磷酸戊糖途径（PPP）总结</h3>
                // ... 添加PPP的内容 ...
            `,
            "TCA": `
                <h1>TCA</h1>
                <h3>三羧酸循环（TCA）总结</h3>
                // ... 添加TCA的内容 ...
            `,
            "GS": `
                <h1>GS</h1>
                <h3>糖原合成途径总结</h3>
                // ... 添加GS的内容 ...
            `,
            "GNG": `
                <h1>GNG</h1>
                <h3>糖异生途径总结</h3>
                // ... 添加GNG的内容 ...
            `,
            "Glycogenesis": `
                <h1>Glycogenesis</h1>
                <h3>糖原合成途径总结</h3>
                // ... 添加Glycogenesis的内容 ...
            `
        };

        function handlePathwayClick(clickedGroup) {
            // 清除其他节点的激活状态
            node.classed("active", false);
            
            // 设置当前点击节点的激活状态
            node.filter(d => d.id === clickedGroup).classed("active", true);

            // 定义不需要半透明的路径组
            const keepOpaqueGroups = ["PPP", "Glycogenesis", "EMP"];

            // 更新所有元素的可见性
            if (keepOpaqueGroups.includes(clickedGroup)) {
                // 如果是 PPP、糖原合成或 EMP，保持 G-6-P 相关的节点和连接不透明
                node.style("opacity", d => {
                    // G-6-P 始终保持不透明
                    if (d.id === "Glucose-6-Phosphate") return 1;
                    // 当前点击组的节点保持不透明
                    return d.group === clickedGroup ? 1 : 0.1;
                });
                
                link.style("opacity", d => {
                    // 如果连接涉及 G-6-P，保持不透明
                    if (d.source.id === "Glucose-6-Phosphate" || d.target.id === "Glucose-6-Phosphate") return 1;
                    // 当前点击组的连接保持不透明
                    return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
                });
                
                doubleLink.style("opacity", d => {
                    // 如果连接涉及 G-6-P，保持不透明
                    if (d.source.id === "Glucose-6-Phosphate" || d.target.id === "Glucose-6-Phosphate") return 1;
                    // 当前点击组的连接保持不透明
                    return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
                });
                
                // 标签的透明度也相应调整
                linkLabels.style("opacity", d => {
                    if (d.source.id === "Glucose-6-Phosphate" || d.target.id === "Glucose-6-Phosphate") return 1;
                    return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
                });
                
                empLinkLabels.style("opacity", d => {
                    if (d.source.id === "Glucose-6-Phosphate" || d.target.id === "Glucose-6-Phosphate") return 1;
                    return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
                });
                
                pppLinkLabels.style("opacity", d => {
                    if (d.source.id === "Glucose-6-Phosphate" || d.target.id === "Glucose-6-Phosphate") return 1;
                    return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
                });
                
                glycogenesisLinkLabels.style("opacity", d => {
                    if (d.source.id === "Glucose-6-Phosphate" || d.target.id === "Glucose-6-Phosphate") return 1;
                    return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
                });
            } else {
                // 其他路径保持原有的半透明效果
                node.style("opacity", d => d.group === clickedGroup ? 1 : 0.1);
                link.style("opacity", d => (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1);
                doubleLink.style("opacity", d => (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1);
                linkLabels.style("opacity", d => (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1);
                empLinkLabels.style("opacity", d => (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1);
                pppLinkLabels.style("opacity", d => (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1);
                glycogenesisLinkLabels.style("opacity", d => (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1);
            }

            // 显示信息面板
            const infoPanel = document.getElementById('info-panel');
            const infoPanelContent = document.getElementById('info-panel-content');
            
            if (pathwayInfo[clickedGroup]) {
                infoPanelContent.innerHTML = pathwayInfo[clickedGroup];
                infoPanel.classList.add('active');
            }
        }

        // 添加关闭面板的事件监听器
        document.getElementById('close-panel').addEventListener('click', () => {
            document.getElementById('info-panel').classList.remove('active');
            // 重置所有元素的显示
            node.style("opacity", 1);
            link.style("opacity", 1);
            doubleLink.style("opacity", 1);
            linkLabels.style("opacity", 1);
            empLinkLabels.style("opacity", 1);
            pppLinkLabels.style("opacity", 1);
            glycogenesisLinkLabels.style("opacity", 1);
            node.classed("active", false);
        });
    </script>
</body>
</html>
