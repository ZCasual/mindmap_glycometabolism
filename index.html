<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代谢路径图</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1e1e1e;
        }

        #graph {
            width: 100%;
            height: 85%;
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            box-sizing: border-box;
        }

        .node circle {
            stroke: #3d3d3d;
            stroke-width: 2px;
        }

        .node.primary circle {
            fill: #2d2d2d;
        }

        .node.secondary circle {
            fill: #252525;
        }

        .node text {
            fill: #d4d4d4;
            text-anchor: middle;
            font-size: 14px;
        }

        .link {
            stroke: #4a4a4a;
            stroke-width: 2px;
        }

        .arrow {
            fill: #4a4a4a;
        }

        #info-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 0;
            height: 100vh;
            background-color: #2d2d2d;
            overflow-y: auto;
            transition: width 0.3s ease;
            padding: 0;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.3);
            z-index: 1000; /* 确保信息面板在最上层 */
        }

        #info-panel.active {
            width: 40%;
            padding: 20px;
        }

        #info-panel-content {
            color: #d4d4d4;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding-bottom: 40px; /* 增加底部内边距 */
            margin-bottom: 20px; /* 增加底部外边距 */
        }

        #info-panel.active #info-panel-content {
            opacity: 1;
        }

        #info-panel h1 {
            color: #fff;
            border-bottom: 2px solid #4a4a4a;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #info-panel h3 {
            color: #2196F3;
            margin-top: 25px;
        }

        #info-panel h4 {
            color: #4CAF50;
            margin-top: 20px;
        }

        #info-panel ul, #info-panel ol {
            padding-left: 20px;
        }

        #info-panel li {
            margin-bottom: 8px;
        }

        #close-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        #close-panel:hover {
            color: #2196F3;
        }

        #control-panel {
            width: 100%;
            height: 15%;
            background-color: #2d2d2d;
            display: flex;
            justify-content: flex-start;  /* 改为 flex-start */
            align-items: center;
            padding: 10px;
            padding-left: 50px;  /* 添加左边距 */
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);
        }

        #control-panel button {
            border: none;
            color: white;
            padding: 10px 20px;
            margin: 0 10px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #control-EMP {
            background-color: #4CAF50; /* EMP 绿色 */
        }

        #control-TCA {
            background-color: #FF5722; /* TCA 橙色 */
        }

        #control-PPP {
            background-color: #2196F3; /* PPP 蓝色 */
        }

        #control-GS {
            background-color: #9C27B0; /* GS 紫色 */
        }

        #control-GNG {
            background-color: #FFC107; /* GNG 黄色 */
        }

        #control-Other {
            background-color: #424242; /* Other 深灰色 */
        }

        #control-panel button:hover {
            opacity: 0.8; /* 鼠标悬停时透明度变化 */
        }

        /* 新增 Other 章节标题样式 */
        #info-panel h1 {
            color: #2196F3; /* 高级标题使用蓝色 */
        }

        #info-panel h2, #info-panel h3, #info-panel h4 {
            color: #FFFFFF; /* 低级标题使用白色 */
        }

        /* 修改滚动条样式，使其更美观 */
        #info-panel::-webkit-scrollbar {
            width: 8px;
        }

        #info-panel::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        #info-panel::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }

        #info-panel::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>

</head>
<body>
    <div id="graph"></div>
    <div id="control-panel">
        <button id="control-EMP">EMP</button>
        <button id="control-TCA">TCA</button>
        <button id="control-PPP">PPP</button>
        <button id="control-GS">GS</button>
        <button id="control-GNG">GNG</button>
        <button id="control-Other">Other</button> <!-- 新增 Other 按钮 -->
    </div>
    <div id="info-panel">
        <button id="close-panel">&times;</button>
        <div id="info-panel-content"></div>
    </div>
    <script>
        const data = {
            nodes: [
                // 主要通路节点
                { id: "EMP", label: "EMP", group: "EMP" },
                { id: "PPP", label: "PPP", group: "PPP" },
                { id: "TCA", label: "TCA", group: "TCA" },
                { id: "GS", label: "GS", group: "GS" },
                { id: "GNG", label: "GNG", group: "GNG" },

                // EMP 途径节点
                { id: "Glucose", label: "葡萄糖", group: "EMP" },
                { id: "Glucose-6-Phosphate", label: "葡萄糖-6-磷酸", group: "EMP" },
                { id: "Fructose-6-Phosphate", label: "果糖-6-磷酸", group: "EMP" },
                { id: "Fructose-1,6-bisphosphate", label: "果糖-1,6-二磷酸", group: "EMP" },
                { id: "Glyceraldehyde-3-Phosphate", label: "甘油醛-3-磷酸", group: "EMP" },
                { id: "Dihydroxyacetone Phosphate", label: "二羟基丙酮磷酸", group: "EMP" },
                { id: "1,3-Bisphosphoglycerate", label: "1,3-二磷酸甘油酸", group: "EMP" },
                { id: "3-Phosphoglycerate", label: "3-磷酸甘油酸", group: "EMP" },
                { id: "2-Phosphoglycerate", label: "2-磷酸甘油酸", group: "EMP" },
                { id: "Phosphoenolpyruvate", label: "磷酸烯醇式丙酮酸", group: "EMP" },
                { id: "Pyruvate", label: "丙酮酸", group: "EMP" },

                // TCA 循环节点
                { id: "AcetylCoA", label: "乙酰辅酶A", group: "TCA" },
                { id: "Citrate", label: "柠檬酸", group: "TCA" },
                { id: "Aconitate", label: "顺乌头酸", group: "TCA" },
                { id: "Isocitrate", label: "异柠檬酸", group: "TCA" },
                { id: "αKG", label: "α-酮戊二酸", group: "TCA" },
                { id: "SuccinylCoA", label: "琥珀酰辅酶A", group: "TCA" },
                { id: "Succinate", label: "琥珀酸", group: "TCA" },
                { id: "Fumarate", label: "延胡索酸", group: "TCA" },
                { id: "Malate", label: "苹果酸", group: "TCA" },
                { id: "OAA", label: "草酰乙酸", group: "TCA" },

                // PPP 途径节点
                { id: "6-Phosphoglucono-δ-lactone", label: "6-磷酸葡糖酸内酯", group: "PPP" },
                { id: "6-Phosphogluconate", label: "6-磷酸葡糖酸", group: "PPP" },
                { id: "Ribulose-5-Phosphate", label: "核糖-5-磷酸", group: "PPP" },
                { id: "Ribose-5-Phosphate", label: "核糖-5-磷酸", group: "PPP" },
                { id: "Erythrose-4-Phosphate", label: "赤藓糖-4-磷酸", group: "PPP" },
                { id: "Sedoheptulose-7-Phosphate", label: "景天庚酮糖-7-磷酸", group: "PPP" },

                // GNG 途径节点
                { id: "Oxaloacetate", label: "草酰乙酸", group: "GNG" },
                { id: "PEP", label: "磷酸烯醇式丙酮酸", group: "GNG" },
                { id: "2PG", label: "2-磷酸甘油酸", group: "GNG" },
                { id: "3PG", label: "3-磷酸甘油酸", group: "GNG" },
                { id: "1,3BPG", label: "1,3-二磷酸甘油酸", group: "GNG" },
                { id: "GAP", label: "甘油醛-3-磷酸", group: "GNG" },
                { id: "DHAP", label: "二羟丙酮磷酸", group: "GNG" },
                { id: "F1,6BP", label: "果糖-1,6-二磷酸", group: "GNG" },
                { id: "F6P", label: "果糖-6-磷酸", group: "GNG" },
                { id: "G6P", label: "葡萄糖-6-磷酸", group: "GNG" },

                // 将 Glycogenesis 途径节点迁移到 GS
                { id: "Glucose1P", label: "葡萄糖-1-磷酸", group: "GS" },
                { id: "UDPGlucose", label: "UDP-葡萄糖", group: "GS" },
                { id: "LinearGlycogen", label: "线性糖原", group: "GS" },
                { id: "BranchedGlycogen", label: "分支糖原", group: "GS" },
                { id: "Glycogen", label: "糖原", group: "GS" }
            ],
            links: [
                { source: "GS", target: "EMP", double: true },
                { source: "EMP", target: "TCA", double: false },
                { source: "TCA", target: "PPP", double: false },
                { source: "EMP", target: "GNG", double: true },
                { source: "GS", target: "GS", double: false },
                { source: "AcetylCoA", target: "OAA", double: false },
                { source: "OAA", target: "Citrate", double: false },
                { source: "Citrate", target: "Aconitate", double: true },
                { source: "Aconitate", target: "Isocitrate", double: true },
                { source: "Isocitrate", target: "αKG", double: false },
                { source: "αKG", target: "SuccinylCoA", double: false },
                { source: "SuccinylCoA", target: "Succinate", double: false },
                { source: "Succinate", target: "Fumarate", double: true },
                { source: "Fumarate", target: "Malate", double: true },
                { source: "Malate", target: "OAA", double: true },
                { source: "Glucose", target: "Glucose-6-Phosphate", double: false },
                { source: "Glucose-6-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "Fructose-6-Phosphate", target: "Fructose-1,6-bisphosphate", double: false },
                { source: "Fructose-1,6-bisphosphate", target: "Glyceraldehyde-3-Phosphate", double: true },
                { source: "Fructose-1,6-bisphosphate", target: "Dihydroxyacetone Phosphate", double: true },
                { source: "Dihydroxyacetone Phosphate", target: "Glyceraldehyde-3-Phosphate", double: true },
                { source: "Glyceraldehyde-3-Phosphate", target: "1,3-Bisphosphoglycerate", double: true },
                { source: "1,3-Bisphosphoglycerate", target: "3-Phosphoglycerate", double: true },
                { source: "3-Phosphoglycerate", target: "2-Phosphoglycerate", double: true },
                { source: "2-Phosphoglycerate", target: "Phosphoenolpyruvate", double: true },
                { source: "Phosphoenolpyruvate", target: "Pyruvate", double: false },
                { source: "Glucose-6-Phosphate", target: "6-Phosphoglucono-δ-lactone", double: false },
                { source: "6-Phosphoglucono-δ-lactone", target: "6-Phosphogluconate", double: false },
                { source: "6-Phosphogluconate", target: "Ribulose-5-Phosphate", double: false },
                { source: "Ribulose-5-Phosphate", target: "Ribose-5-Phosphate", double: true },
                { source: "Ribulose-5-Phosphate", target: "Erythrose-4-Phosphate", double: true },
                { source: "Ribose-5-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "Erythrose-4-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "Erythrose-4-Phosphate", target: "Sedoheptulose-7-Phosphate", double: true },
                { source: "Sedoheptulose-7-Phosphate", target: "Fructose-6-Phosphate", double: true },
                { source: "Pyruvate", target: "AcetylCoA", double: false },
                { source: "Pyruvate", target: "Oxaloacetate", double: false },
                { source: "Oxaloacetate", target: "PEP", double: false },
                { source: "PEP", target: "2PG", double: false },
                { source: "2PG", target: "3PG", double: true },
                { source: "3PG", target: "1,3BPG", double: false },
                { source: "1,3BPG", target: "GAP", double: false },
                { source: "GAP", target: "DHAP", double: true },
                { source: "GAP", target: "F1,6BP", double: false },
                { source: "F1,6BP", target: "F6P", double: false },
                { source: "F6P", target: "G6P", double: true },
                { source: "G6P", target: "Glucose", double: false },
                { source: "Glucose-6-Phosphate", target: "Glucose1P", double: false },
                { source: "Glucose1P", target: "UDPGlucose", double: false },
                { source: "UDPGlucose", target: "LinearGlycogen", double: false },
                { source: "LinearGlycogen", target: "BranchedGlycogen", double: false },
                { source: "BranchedGlycogen", target: "Glycogen", double: false }
            ]
        };

        const width = document.getElementById('graph').clientWidth;
        const height = document.getElementById('graph').clientHeight;

        const svg = d3.select("#graph")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const g = svg.append("g");

        // 添加缩放功能
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // 添加颜色比例尺
        const color = d3.scaleOrdinal()
            .domain(["EMP", "TCA", "PPP", "GS", "GNG"])
            .range(["#4CAF50", "#FF5722", "#2196F3", "#9C27B0", "#FFC107"]);

        // 定义箭头
        const defs = g.append("defs");
        
        // 定义箭头标记
        defs.append("marker")
            .attr("id", "arrow")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 10)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("class", "arrow");

        // 创建连接线
        const link = g.append("g")
            .selectAll("line")
            .data(data.links)
            .join("line")
            .attr("class", "link")
            .attr("marker-end", "url(#arrow)")
            .style("stroke", "#4a4a4a")
            .style("stroke-width", "2px");

        // 为双向连接添加反向线段
        const doubleLink = g.append("g")
            .selectAll("line")
            .data(data.links.filter(d => d.double))
            .join("line")
            .attr("class", "link")
            .attr("marker-end", "url(#arrow)")
            .style("stroke", "#4a4a4a")
            .style("stroke-width", "2px");

        // 添加关键酶和产物信息
        const linkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose" && d.target === "Glucose-6-Phosphate") {
                    return "[己糖激酶/葡萄糖激酶, ATP -> ADP]";
                } else if (d.source === "OAA" && d.target === "Citrate") {
                    return "[柠檬酸合酶, +H₂O]";
                } else if (d.source === "Citrate" && d.target === "Aconitate") {
                    return "[顺乌头酸酶, -H₂O]";
                } else if (d.source === "Aconitate" && d.target === "Isocitrate") {
                    return "[顺乌头酸酶, +H₂O]";
                } else if (d.source === "Isocitrate" && d.target === "αKG") {
                    return "[异柠檬酸脱氢酶, CO₂, NAD⁺ -> NADH]";
                } else if (d.source === "αKG" && d.target === "SuccinylCoA") {
                    return "[α-酮戊二酸脱氢酶复合体, CO₂, NAD⁺ -> NADH]";
                } else if (d.source === "SuccinylCoA" && d.target === "Succinate") {
                    return "[琥珀酰辅酶A合成酶, GDP -> GTP]";
                } else if (d.source === "Succinate" && d.target === "Fumarate") {
                    return "[琥珀酸脱氢酶, FAD -> FADH₂]";
                } else if (d.source === "Fumarate" && d.target === "Malate") {
                    return "[延胡索酸酶, +H₂O]";
                } else if (d.source === "Malate" && d.target === "OAA") {
                    return "[苹果酸脱氢酶, NAD⁺ -> NADH]";
                }
                return "";
            });

        // 添加关键酶和产物信息
        const empLinkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose-6-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[磷酸己糖异构酶]";
                } else if (d.source === "Fructose-6-Phosphate" && d.target === "Fructose-1,6-bisphosphate") {
                    return "[磷酸果糖激酶-1, ATP -> ADP]";
                } else if (d.source === "Fructose-1,6-bisphosphate" && d.target === "Glyceraldehyde-3-Phosphate") {
                    return "[醛缩酶]";
                } else if (d.source === "Dihydroxyacetone Phosphate" && d.target === "Glyceraldehyde-3-Phosphate") {
                    return "[磷酸三糖异构酶]";
                } else if (d.source === "Glyceraldehyde-3-Phosphate" && d.target === "1,3-Bisphosphoglycerate") {
                    return "[甘油醛-3-磷酸脱氢酶, NAD⁺ -> NADH]";
                } else if (d.source === "1,3-Bisphosphoglycerate" && d.target === "3-Phosphoglycerate") {
                    return "[磷酸甘油酸激酶, ADP -> ATP]";
                } else if (d.source === "3-Phosphoglycerate" && d.target === "2-Phosphoglycerate") {
                    return "[磷酸甘油酸变位酶]";
                } else if (d.source === "2-Phosphoglycerate" && d.target === "Phosphoenolpyruvate") {
                    return "[烯醇化酶]";
                } else if (d.source === "Phosphoenolpyruvate" && d.target === "Pyruvate") {
                    return "[丙酮酸激酶, ADP -> ATP]";
                } else if (d.source === "Pyruvate" && d.target === "AcetylCoA") {
                    return "[丙酮酸脱氢酶复合体, NAD⁺ -> NADH, CoA-SH -> CO₂]";
                }
                return "";
            });

        // 添加关键酶和产物信息
        const pppLinkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose-6-Phosphate" && d.target === "6-Phosphoglucono-δ-lactone") {
                    return "[葡萄糖-6-磷酸脱氢酶, NADP⁺ -> NADPH]";
                } else if (d.source === "6-Phosphoglucono-δ-lactone" && d.target === "6-Phosphogluconate") {
                    return "[6-磷酸葡糖酸内酯酶]";
                } else if (d.source === "6-Phosphogluconate" && d.target === "Ribulose-5-Phosphate") {
                    return "[6-磷酸葡糖酸脱氢酶, NADP⁺ -> NADPH+CO₂]";
                } else if (d.source === "Ribulose-5-Phosphate" && d.target === "Ribose-5-Phosphate") {
                    return "[磷酸戊糖异构酶]";
                } else if (d.source === "Ribulose-5-Phosphate" && d.target === "Erythrose-4-Phosphate") {
                    return "[转酮醇酶]";
                } else if (d.source === "Ribose-5-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[转醛醇酶]";
                } else if (d.source === "Erythrose-4-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[转醛醇酶]";
                } else if (d.source === "Erythrose-4-Phosphate" && d.target === "Sedoheptulose-7-Phosphate") {
                    return "[转酮醇酶]";
                } else if (d.source === "Sedoheptulose-7-Phosphate" && d.target === "Fructose-6-Phosphate") {
                    return "[转醛醇酶]";
                }
                return "";
            });

        // 添加关键酶和产物信息
        const glycogenesisLinkLabels = g.append("g")
            .selectAll("text")
            .data(data.links)
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source === "Glucose" && d.target === "Glucose-6-Phosphate") {
                    return "[己糖激酶/葡萄糖激酶, ATP -> ADP]";
                } else if (d.source === "Glucose-6-Phosphate" && d.target === "Glucose1P") {
                    return "[磷酸葡萄糖变位酶]";
                } else if (d.source === "Glucose1P" && d.target === "UDPGlucose") {
                    return "[UDP-葡萄糖焦磷酸化酶, UTP -> PPi]";
                } else if (d.source === "UDPGlucose" && d.target === "LinearGlycogen") {
                    return "[糖原合成酶, UDP]";
                } else if (d.source === "LinearGlycogen" && d.target === "BranchedGlycogen") {
                    return "[糖原分支酶]";
                }
                return "";
            });

        // 创建节点
        const node = g.append("g")
            .selectAll(".node")
            .data(data.nodes)
            .join("g")
            .attr("class", d => `node ${d.type}`)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        node.append("circle")
            .attr("r", 30)
            .style("fill", d => color(d.group))
            .style("stroke", "#3d3d3d")
            .style("stroke-width", "2px");

        node.append("text")
            .text(d => d.label)
            .attr("dy", ".35em")
            .style("fill", "#FFFFFF");

        // 定义主要通路节点
        const mainPathways = ["EMP", "TCA", "PPP", "GS", "GNG"];

        // 为节点添加点击事件
        node.on("click", (event, d) => {
            if (mainPathways.includes(d.id)) {
                handlePathwayClick(d.id);
            } else {
                // 点击其他节点时恢复所有元素显示
                resetPathwayDisplay();
            }
        });

        // 添加重置显示函数
        function resetPathwayDisplay() {
            // 清除激活状态
            node.classed("active", false);
            
            // 恢复所有元素的完全显示
            node.style("opacity", 1);
            link.style("opacity", 1);
            doubleLink.style("opacity", 1);
            linkLabels.style("opacity", 1);
            empLinkLabels.style("opacity", 1);
            pppLinkLabels.style("opacity", 1);
            glycogenesisLinkLabels.style("opacity", 1);
            gngLinkLabels.style("opacity", 1);
            node.classed("active", false);
        }

        // 力向图
        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links)
                .id(d => d.id)
                .distance(200))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(50));

        // 更新位置
        simulation.on("tick", () => {
            link.attr("x1", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.x + (dx * 25) / dr;
            })
            .attr("y1", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.y + (dy * 25) / dr;
            })
            .attr("x2", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.x - (dx * 27) / dr;
            })
            .attr("y2", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.y - (dy * 27) / dr;
            });

            // 更新双向连的反向线段
            doubleLink.attr("x1", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.x + (dx * 25) / dr;
            })
            .attr("y1", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.target.y + (dy * 25) / dr;
            })
            .attr("x2", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.x - (dx * 27) / dr;
            })
            .attr("y2", d => {
                const dx = d.source.x - d.target.x;
                const dy = d.source.y - d.target.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                return d.source.y - (dy * 27) / dr;
            });

            node.attr("transform", d => `translate(${d.x},${d.y})`);

            // 更新 GNG 途径的连接线标签位置
            gngLinkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                         .attr("y", d => (d.source.y + d.target.y) / 2);

            // 更新关键酶和产物信息的位置
            linkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                      .attr("y", d => (d.source.y + d.target.y) / 2);

            // 更新EMP途径的连接线标签位置
            empLinkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                         .attr("y", d => (d.source.y + d.target.y) / 2);

            // 更新PPP途径的连接线标签位置
            pppLinkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                         .attr("y", d => (d.source.y + d.target.y) / 2);

            // 更新糖原生成途径的连接线标签位置
            glycogenesisLinkLabels.attr("x", d => (d.source.x + d.target.x) / 2)
                                 .attr("y", d => (d.source.y + d.target.y) / 2);
        });

        // 拖拽函数
        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        // 响应窗口大小变化
        window.addEventListener('resize', () => {
            const newWidth = document.getElementById('graph').clientWidth;
            const newHeight = document.getElementById('graph').clientHeight;
            
            svg.attr("width", newWidth)
               .attr("height", newHeight);
            
            simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2))
                     .restart();
        });

        const pathwayInfo = {
            "EMP": `
                <h1>EMP</h1>
                <h3>糖酵解途径（Embden-Meyerhof-Parnas Pathway，EMP）</h3>
                <h4>定义</h4>
                <p>糖酵解途径（EMP）是将一分子葡萄糖分解为两分子丙酮酸的过程，同时生成ATP和NADH。该过程在细胞质中进行，是葡萄糖有氧和无氧分解的共同起始途径。</p>

                <h4>反应位置</h4>
                <p>糖酵解途径发生在细胞质中。</p>

                <h4>关键酶</h4>
                <p>糖酵解过程中的关键酶包括：</p>
                <ol>
                    <li><strong>己糖激酶（Hexokinase, HK）</strong>：该酶受产物葡萄糖-6-磷酸的反馈抑制，但并非主要限速步骤。</li>
                    <li><strong>磷酸果糖激酶-1（Phosphofructokinase-1, PFK-1）</strong>：这是糖酵解的主要限速酶，PFK-1受到能量状态的强烈调控——ATP和柠檬酸抑制其活性，而ADP、AMP和果糖-2,6-二磷酸促进其活性。</li>
                    <li><strong>丙酮酸激酶（Pyruvate Kinase, PK）</strong>：其活性受ATP抑制，而ADP、AMP等激活物会增强其活性。</li>
                </ol>

                <h4>总能量（ATP）计算过程</h4>
                <p>糖酵解途径中ATP的生成和消耗：</p>
                <ol>
                    <li><strong>消耗</strong>：2 ATP</li>
                    <li><strong>生成</strong>：4 ATP + 2 NADH（约 5 ATP 等效）</li>
                    <li><strong>总计</strong>：7 ATP</li>
                </ol>

                <h4>意义</h4>
                <p>糖酵解途径具有重要的生理意义：</p>
                <ol>
                    <li><strong>快速能量供应</strong>：糖酵解是无氧条件下（如剧烈运动时）快速提供能量的主要途径，能够迅速生成ATP以满足细胞的能量需求。</li>
                    <li><strong>有氧代谢前体</strong>：糖酵生成的丙酮酸可以进入线粒体，进一步参与有氧呼吸，生成更多的ATP。</li>
                    <li><strong>中间代谢产物</strong>：糖酵解途径的中间产物可以用于其他代谢途径，如磷酸戊糖途径、氨基酸合成等。</li>
                    <li><strong>维持氧化还原平衡</strong>：糖酵解过程中生成的NADH需要通过乳酸发酵或其他途径重新氧化为NAD+，以维持细胞内的氧化还原平衡。</li>
                </ol>
                <p>糖酵解途径在生物体的能量代谢中起着至关重要的作用，是多种代谢途径的交汇点和基础。</p>
            `,
            "PPP": `
                <h1>PPP</h1>
                <h3>磷酸戊糖途径（Pentose Phosphate Pathway，PPP）</h3>

                <h4>定义</h4>
                <p>磷酸戊糖途径（PPP），是一种在细质中进行的代谢途径。该途径的主要功能是生成核苷酸合成所需的核糖-5-磷酸和维持细胞内还原型谷胱甘肽的水平。PPP分为两个阶段：氧化阶段和非氧化阶段。氧化阶段生成NADPH，而非氧化阶段则涉及糖磷酸的相互转化以生成核糖-5-磷酸。</p>

                <h4>反应位置</h4>
                <p>磷酸戊糖途径发生在细胞质中。</p>

                <h4>关键酶</h4>
                <p>磷酸戊糖途径中的关键酶包括：</p>
                <ol>
                    <li><strong>葡萄糖-6-磷酸脱氢酶（Glucose-6-phosphate Dehydrogenase, G6PD）</strong>：这是PPP的关键限速酶，其活性受到NADPH的反馈抑制，而NADP⁺的存在能激活其活性，促进该途径以生成还原力。</li>
                </ol>

                <h4>总能量（ATP）计算过程</h4>
                <p>磷酸戊糖途径中的能量生成：</p>
                <ol>
                    <li><strong>消耗</strong>：无直接消耗</li>
                    <li><strong>生成</strong>：2 NADPH（不转化为ATP，用于还原作用）</li>
                    <li><strong>总计</strong>：无ATP直接生成</li>
                </ol>

                <h4>意义</h4>
                <p>磷酸戊糖途径具有重要的生理意义：</p>
                <ol>
                    <li><strong>NADPH提供还原力</strong>：NADPH是脂肪酸合成、胆固醇合成和谷胱甘肽还原等还原性生物合成过程的重要电子供体。NADPH维持谷胱甘肽的还原状态（GSH），从而保护细胞免受氧化应激和过氧化物的损害。</li>
                    <li><strong>核糖-5-磷酸供应</strong>：核糖-5-磷酸是核苷酸和核酸合成的必需前体，特别是在快速分裂的细胞中（如骨髓细胞和癌细胞）尤为重要。</li>
                    <li><strong>维持细胞抗氧化能力</strong>：PPP生成的NADPH支持谷胱甘肽还原系统，帮助维持细胞内抗氧化防御机制，保护细胞免受氧化损伤。</li>
                    <li><strong>支持其他代谢途径</strong>：PPP的中间产物可以进入糖酵解途径，支持能量代谢和生物合成过程。</li>
                </ol>
                <p>磷酸戊糖途径不仅是核苷酸合成和NADPH生成的关键途径，还在维持细胞抗氧化能力和支持多种代谢过程中发挥重要作用。</p>
            `,
            "TCA": `
                <h1>TCA</h1>
                <h3>三羧酸循环（TCA循环，Tricarboxylic Acid Cycle）</h3>

                <h4>定义</h4>
                <p>三羧酸循环（TCA循环），发生在线粒体基质中，TCA循环不仅是能量产生的核心环节，也是多种代谢中间产物的重要来源，通过氧化乙酰辅酶A（Acetyl-CoA）生成高能分子以及二氧化碳。</p>

                <h4>反应位置</h4>
                <p>三羧酸循环发生线粒体基质中。</p>

                <h4>关键酶</h4>
                <p>TCA循环中的关键酶包括：</p>
                <ol>
                    <li><strong>柠檬酸合酶（Citrate synthase）</strong>：受ATP和NADH的反馈抑制。</li>
                    <li><strong>异柠檬酸脱氢酶（Isocitrate dehydrogenase）</strong>：这是TCA循环的主要限速酶，被ADP激活，受NADH的反馈抑制。</li>
                    <li><strong>α-酮戊二酸脱氢酶复合体（α-Ketoglutarate dehydrogenase complex）</strong>：其活性受NADH抑制，且受底物（α-酮戊二酸）浓度调控。</li>
                </ol>

                <h4>总能量（ATP）计算过程</h4>
                <p>每分子乙酰辅酶A通过TCA循环的ATP生成：</p>
                <ol>
                    <li><strong>消耗</strong>：
                        <ul>无直接消耗</ul>
                    <li><strong>生成</strong>：
                        <ul>
                            3 NADH（7.5 ATP）+ 1 FADH₂（1.5 ATP）+1 GTP（1 ATP）
                        </ul>
                    </li>
                    <li><strong>总计</strong>：10 ATP</li>
                </ol>

                <h4>意义</h4>
                <p>TCA循环在细胞代谢中具有重要的生理意义：</p>
                <ol>
                    <li><strong>能量生产</strong>：TCA循环是需氧生物体中ATP生成的主要途径之一。通过氧化乙酰辅酶A生成NADH和FADH2，这些高能分子进入电子传递链，最终生成大量ATP。</li>
                    <li><strong>中间谢产物供应</strong>：TCA循环不仅能量产生的核心环节，还提供了多种重要的代谢中间产物。这些中间产物可以作为生物合成的前体，用于氨基酸、核苷酸、葡萄糖等生物分子的合成。</li>
                    <li><strong>支持其他代谢途径</strong>：TCA循环与糖异生、脂肪酸氧化、氨基酸分解代谢等多个代谢途径密切相关。</li>
                    <li><strong>氧化还原平衡的维持</strong>：TCA循环通过生成NADH和FADH2，维持细胞内的氧化还原平衡。</li>
                    <li><strong>支持呼吸链功能</strong>：TCA循环生成的NADH和FADH2作为电子传递链的电子供体，驱动氧化磷酸化过程，生成ATP。</li>
                </ol>
            `,
            "GS": `
                <h1>GS</h1>
                <h3>糖原合成（Glycogen Synthesis，GS）</h3>

                <h4>定义</h4>
                <p>糖原合成是指将葡萄糖分子聚合形成糖原的过程。糖原是一种多分支的多糖，是动物和细菌中葡萄糖的储存形式。在人体中，糖原主要储存在肝脏和肌肉中，作为能量储备，以备需要时快速动员提供能量。</p>

                <h4>反应位置</h4>
                <p>糖原合成主要发生在肝脏和肌肉细胞的细胞质中。</p>

                <h4>关键酶</h4>
                <p>糖原合成过程中的关键酶包括：</p>
                <ol>
                    <li><strong>糖原合酶（Glycogen Synthase）</strong>：糖原合酶为糖原合成的限速酶，受到磷酸化的抑制（受胰高血糖素信号调控）和去磷酸化的激活（受胰岛素信号调控），并且在葡萄糖-6-磷酸存在下活性进一步增强。</li>
                </ol>

                <h4>总能量（ATP）计算过程</h4>
                <p>糖原合成过程中ATP的消耗：</p>
                <ol>
                    <li><strong>消耗</strong>：2 ATP/葡萄糖</li>
                    <li><strong>生成</strong>：无</li>
                    <li><strong>总计</strong>：-2 ATP</li>
                </ol>

                <h4>意义</h4>
                <p>糖原合成具有重要的生理意义：</p>
                <ol>
                    <li><strong>能量储备</strong>：糖原作为葡萄糖的储存形式，可以在需要时快速动员提供能量，特别是在肌肉活动和禁食状态下。</li>
                    <li><strong>血糖调节</strong>：肝脏中的糖原可以在血糖水平下降时分解为葡萄糖，释放到血液中，维持血糖水平的稳定。</li>
                    <li><strong>节约蛋白质和脂肪</strong>：充足的糖原储备可以减少对蛋白质和脂肪的依赖，从而保护蛋白质不被过度消耗，同时避免过多的脂肪分解产生酮体。</li>
                </ol>
                <p>糖原合成和分解的精细调控对于维持机体的能量平衡和代谢健康至关重要。</p>
            `,
            "GNG": `
                <h1>GNG</h1>
                <h3>糖异生（Gluconeogenesis, GNG）</h3>

                <h4>定义</h4>
                <p>糖异生（GNG）是生物体内由非碳水化合物底物（如乳酸、甘油和氨基酸）生成葡萄糖的过程。该过程主要在肝脏和肾脏中进行，对于维持血糖水平的稳定至关重要。</p>

                <h4>反应位置</h4>
                <p>糖异生主要发生在肝脏和肾脏的细胞质和线粒体中。</p>

                <h4>关键酶</h4>
                <p>糖异生途径中，有几个关键的酶是糖酵解途径中没有的，或者说是为了绕过糖酵解中的不可逆步骤而存在的。以下是糖异生的关键酶：</p>
                <ol>
                    <li><strong>丙酮酸羧化酶（Pyruvate Carboxylase, PC）</strong>：PC的活性受到ADP的抑制，而乙酰辅酶A则显著激活PC，增强糖异生途径起始阶段的活性。</li>
                    <li><strong>磷酸烯醇式丙酮酸羧激酶（PEPCK）</strong>：PEPCK在糖异生中也是限速酶，其活性受ADP抑制，而高浓度的葡萄糖-6-磷酸则有助于增强其活性，推进糖异生过程。</li>
                    <li><strong>果糖-1,6-二磷酸酶（Fructose-1,6-bisphosphatase, FBPase-1）</strong>：FBPase-1受到果糖-2,6-二磷酸和AMP的抑制，而柠檬酸则会激活其活性，是糖异生中一个重要的调控点。</li>
                </ol>

                <h4>总能量（ATP）计算过程</h4>
                <p>从丙酮酸到葡萄糖的糖异生过程中ATP的消耗：</p>
                <ol>
                    <li><strong>消耗</strong>：6 ATP</li>
                    <li><strong>生成</strong>：无</li>
                    <li><strong>总计</strong>：-6 ATP</li>
                </ol>

                <h4>意义</h4>
                <p>糖异生是维持血糖稳态的关键代谢途径，尤其在空腹、饥饿、长时间运动以及机体对碳水化合物需求增加的情况下。以下糖异生的主要生理意义：</p>
                <ol>
                    <li><strong>维持血糖水平稳定</strong>：糖异生在维持血糖稳态中起着至关重要的作用，特别是在空腹或饥饿状态下。</li>
                    <li><strong>在糖酵解和糖异生之间实现代谢平衡</strong>：糖酵解和糖异生是两个相反的代谢途径，但它们在机体内是协调进行的。</li>
                    <li><strong>支持运动和应激状态下的能量需求</strong>：在长时间的中高强度运动中，肝脏通过糖异生补充血糖，以维持全身的能量需求。</li>
                    <li><strong>乳酸再利用</strong>：在剧烈运动中，肌肉通过无氧糖酵解生成乳酸，乳酸通过血液运输到肝脏，肝脏通过糖异生将乳酸转化为葡萄糖。</li>
                    <li><strong>甘油和氨基酸的利用</strong>：在饥饿或长时间运动时，脂肪和蛋白质分解增加，甘油和氨基酸成为糖异生的重要底物。</li>
                    <li><strong>肝脏和肾脏的功能</strong>：肝脏是糖异生的主要器官，约90%的糖异生发生在肝脏中。</li>
                    <li><strong>饥饿和糖尿病等病理状态下的适应</strong>：在长时间禁食或饥饿时，肝脏和肾脏通过糖异生生成葡萄糖。</li>
                </ol>
                <p>糖异生通过消耗能量和利用非糖底物，确保机体在不同生理和病理状态下能够持续获得葡萄糖。</p>
            `,
            "Other": `
                <h1>Other</h1>
                <h2>葡萄糖的完全氧化</h2>
                <p>在葡萄糖的完全氧化过程中，ATP的产量在不同生物或不同条件下有所不同。具体来说，32 ATP 和 30 ATP 的差异主要与 NADH 的跨膜转运和氧化磷酸化的效率有关。</p>

                <h3>32 ATP 的情况</h3>
                <p>通常情况下，真核生物在葡萄糖的完全氧化过程中生成 32 ATP。这个ATP总数是基于以下的情况：</p>
                <ol>
                    <li><strong>糖酵解</strong>：生成2 ATP（直接产生），并且生成2 NADH。每个NADH可以在电子传递链中生成约2.5个ATP。</li>
                    <li><strong>丙酮酸转化为乙酰辅酶A</strong>：每分子丙酮酸生成1 NADH，生成2个丙酮酸，所以产生2 NADH。</li>
                    <li><strong>TCA循环</strong>：每轮TCA循环生成3 NADH、1 FADH₂和1 GTP（等效于ATP）。</li>
                </ol>
                <p>综合上述：7 ATP（糖酵解） + 5 ATP（丙酮酸转化） + 20 ATP（TCA循环） = 32 ATP。</p>

                <h3>30 ATP 的情况</h3>
                <p>在一些情况下，尤其是当NADH的转运效率不如理想时，生成的ATP会少于32。这个减少通常与 NADH 穿越线粒体膜的方式有关。</p>

                <h2>丙酮酸去路</h2>
                <p>丙酮酸是糖酵解的最终产物，在有氧条件下，它的去路会受到细胞代谢状态的影响，主要有以下几条去路：</p>
                <h3>1. 有氧条件下：进入线粒体，转化为乙酰辅酶A</h3>
                <p>在有氧条件下，丙酮酸通过丙酮酸脱氢酶复合物转化为乙酰辅酶A。乙酰辅酶A随后进入柠檬酸循环，进一步被氧化为二氧化碳，同时产生NADH、FADH₂和ATP（或GTP）。</p>

                <h3>2. 无氧条件下：乳酸发酵</h3>
                <p>当细胞处于缺氧条件下，丙酮酸无法进入线粒体并参与TCA循环，因为电子传递链缺乏足够的氧气来接受电子。在这种情况下，丙酮酸会被乳酸脱氢酶还原为乳酸，以再生NAD+，从而维持糖酵解过程的进行。</p>

                <h3>3. 丙酮酸向葡萄糖的转化（糖异生）</h3>
                <p>在某些情况下（如饥饿或长期运动时），丙酮酸可通过糖异生途径转化为葡萄糖。这个过程发生在肝脏和肾脏。</p>

                <h3>4. 脂肪酸合成</h3>
                <p>丙酮酸还可以通过乙酰辅酶A的途径参与脂肪酸的合成。当能量过剩时，丙酮酸会转化为乙酰辅酶A，乙酰辅酶A在细胞内被用来合成脂肪酸。</p>

                <h3>5. 其他代谢途径</h3>
                <p>丙酮酸还可以转化为氨基酸的前体，特别是在氮代谢中，作为合成某些氨基酸的底物。</p>

                <h3>总结</h3>
                <p>丙酮酸的去路在细胞内主要受到氧气供应和能量需求的调控。其主要去路包括有氧条件下转化为乙酰辅酶A，进入TCA循环进行氧化；无氧条件下转化为乳酸，参与乳酸发酵；糖异生途径在肝脏和肾脏通过糖异生合成葡萄糖；脂肪酸合成转化为乙酰辅酶A，参与脂肪酸合成；氨基酸合成作为某些氨基酸的前体。</p>

                <h2>糖的代谢及其相关酶促水解</h2>
                <p>糖的代谢包括了多个途径，涉及不同糖类物质的合成、分解以及转化过程。淀粉、糖原和纤维素是常见的多糖类物质，它们的酶促水解过程对糖类的利用至关重要。以下是关于淀粉与糖原的酶促水解和纤维素的酶促水解的简要介绍。</p>

                <h3>1. 淀粉的酶促水解</h3>
                <p>淀粉是植物储存的多糖，主要由直链淀粉（Amylose）和支链淀粉（Amylopectin）组成。淀粉的水解过程通过多种酶的作用将其分解为可利用的小分子。</p>
                <ul>
                    <li><strong>α-淀粉酶（Alpha-amylase）</strong>：α-淀粉酶通过水解淀粉中的α-1,4糖苷键，将淀粉分解为麦芽糖（Maltose）和糊精（Dextrin）。</li>
                    <li><strong>葡萄糖苷酶（Glucosidase）</strong>：进一步将麦芽糖分解为葡萄糖。</li>
                </ul>

                <h3>2. 糖原的酶促水解</h3>
                <p>糖原是动物储存的多糖，主要存在于肝脏和肌肉中，其水解过程帮助细胞迅速获取葡萄糖作为能量来源。</p>
                <ul>
                    <li><strong>糖原磷酸化酶（Glycogen Phosphorylase）</strong>：糖原磷酸化酶将糖原的α-1,4糖苷键水，生成葡萄糖-1-磷酸。</li>
                    <li><strong>糖原变位酶（Glycogen Debranching Enzyme）</strong>：当糖原链上的分支点处发生支链时，糖原变位酶会将支链的α-1,6糖苷键水解，生成葡萄糖。</li>
                    <li><strong>葡萄糖-6-磷酸酶（Glucose-6-Phosphatase）</strong>：在肝脏中，葡萄糖-6-磷酸酶将葡萄糖-6-磷酸水解为葡萄糖，并释放到血液中，供机体利用。</li>
                </ul>

                <h3>3. 纤维素的酶促水解</h3>
                <p>纤维素是植物细胞壁的主要成分，由β-1,4糖苷键连接的葡萄糖分子构成。纤维素的水解较为复杂，通常需要特定的酶</p>
                <ul>
                    <li><strong>纤维素酶（Cellulase）</strong>：纤维素酶能够水解纤维素的β-1,4糖苷键，将纤维素分解为葡萄糖或低聚糖。</li>
                </ul>

                <h3>总结</h3>
                <p>这些水解反应是糖类代谢的重要组成部分，分别为细胞提供能量或作为细胞壁和储存形式的糖源。</p>
            `
        };

        function handlePathwayClick(clickedGroup) {
            // 清除其他节点的激活状态
            node.classed("active", false);
            
            // 设置当前点击节点的激活状态
            node.filter(d => d.id === clickedGroup).classed("active", true);

            // 找出当前通路的最远端节点
            const terminalNodes = data.nodes.filter(n => {
                if (n.group !== clickedGroup) return false;
                // 计算与该节点相连的同组节点数量
                const connections = data.links.filter(l => 
                    (l.source.id === n.id || l.target.id === n.id) &&
                    (l.source.group === clickedGroup && l.target.group === clickedGroup)
                ).length;
                // 如果只有一个连接，说明是端点
                return connections <= 1;
            }).map(n => n.id);

            // 找出与最远端节点直接相连的其他通路节点
            const connectedNodes = new Set();
            terminalNodes.forEach(nodeId => {
                data.links.forEach(l => {
                    if (l.source.id === nodeId && l.source.group !== l.target.group) {
                        connectedNodes.add(l.target.id);
                    }
                    if (l.target.id === nodeId && l.source.group !== l.target.group) {
                        connectedNodes.add(l.source.id);
                    }
                });
            });

            // 更新节点的透明度
            node.style("opacity", d => {
                if (d.group === clickedGroup) return 1;
                if (connectedNodes.has(d.id)) return 1;
                return 0.1;
            });

            // 更新连接线的透明度
            link.style("opacity", d => {
                // 如果连接的任一端是最远端节点或其直接相连节点
                if (terminalNodes.includes(d.source.id) || terminalNodes.includes(d.target.id) ||
                    connectedNodes.has(d.source.id) || connectedNodes.has(d.target.id)) {
                    return 1;
                }
                return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
            });

            doubleLink.style("opacity", d => {
                if (terminalNodes.includes(d.source.id) || terminalNodes.includes(d.target.id) ||
                    connectedNodes.has(d.source.id) || connectedNodes.has(d.target.id)) {
                    return 1;
                }
                return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
            });

            // 更新标签的透明度
            const updateLabelOpacity = (labelSelection) => {
                labelSelection.style("opacity", d => {
                    if (terminalNodes.includes(d.source.id) || terminalNodes.includes(d.target.id) ||
                        connectedNodes.has(d.source.id) || connectedNodes.has(d.target.id)) {
                        return 1;
                    }
                    return (d.source.group === clickedGroup || d.target.group === clickedGroup) ? 1 : 0.1;
                });
            };

            // 应用到所有标签
            updateLabelOpacity(linkLabels);
            updateLabelOpacity(empLinkLabels);
            updateLabelOpacity(pppLinkLabels);
            updateLabelOpacity(glycogenesisLinkLabels);
            updateLabelOpacity(gngLinkLabels);

            // 显示信息面板
            const infoPanel = document.getElementById('info-panel');
            const infoPanelContent = document.getElementById('info-panel-content');
            
            if (pathwayInfo[clickedGroup]) {
                infoPanelContent.innerHTML = pathwayInfo[clickedGroup];
                infoPanel.classList.add('active');
            }
        }

        // 添加关闭面板的事件监听器
        document.getElementById('close-panel').addEventListener('click', () => {
            document.getElementById('info-panel').classList.remove('active');
            // 重置所有元素的显示
            node.style("opacity", 1);
            link.style("opacity", 1);
            doubleLink.style("opacity", 1);
            linkLabels.style("opacity", 1);
            empLinkLabels.style("opacity", 1);
            pppLinkLabels.style("opacity", 1);
            glycogenesisLinkLabels.style("opacity", 1);
            gngLinkLabels.style("opacity", 1);
            node.classed("active", false);
        });

        // 修改 GNG 途径的连接标签定义
        const gngLinkLabels = g.append("g")
            .selectAll("text")
            .data(data.links.filter(d => d.source.group === "GNG" || d.target.group === "GNG"))
            .join("text")
            .attr("class", "link-label")
            .attr("text-anchor", "middle")
            .attr("dy", -5)
            .style("fill", "#FFFFFF")
            .text(d => {
                if (d.source.id === "Pyruvate" && d.target.id === "Oxaloacetate") {
                    return "[丙酮酸羧化酶, ATP->ADP]";
                } else if (d.source.id === "Oxaloacetate" && d.target.id === "PEP") {
                    return "[磷酸烯醇式丙酮酸羧激酶, GTP->GDP]";
                } else if (d.source.id === "PEP" && d.target.id === "2PG") {
                    return "[烯醇化酶]";
                } else if (d.source.id === "2PG" && d.target.id === "3PG") {
                    return "[磷酸甘油酸变位酶]";
                } else if (d.source.id === "3PG" && d.target.id === "1,3BPG") {
                    return "[磷酸甘油酸激酶, ATP->ADP]";
                } else if (d.source.id === "1,3BPG" && d.target.id === "GAP") {
                    return "[甘油醛-3-磷酸脱氢酶, NADH + H⁺ -> NAD⁺]";
                } else if (d.source.id === "GAP" && d.target.id === "DHAP") {
                    return "[磷酸三碳异构酶]";
                } else if (d.source.id === "GAP" && d.target.id === "F1,6BP") {
                    return "[醛缩酶]";
                } else if (d.source.id === "F1,6BP" && d.target.id === "F6P") {
                    return "[果糖-1,6-二磷酸酶]";
                } else if (d.source.id === "F6P" && d.target.id === "G6P") {
                    return "[磷酸己糖异构酶]";
                } else if (d.source.id === "G6P" && d.target.id === "Glucose") {
                    return "[葡萄糖-6-磷酸酶]";
                }
                return "";
            });

        // 新增控制按钮的事件监听器
        document.getElementById('control-EMP').addEventListener('click', () => {
            handlePathwayClick('EMP');
        });

        document.getElementById('control-TCA').addEventListener('click', () => {
            handlePathwayClick('TCA');
        });

        document.getElementById('control-PPP').addEventListener('click', () => {
            handlePathwayClick('PPP');
        });

        document.getElementById('control-GS').addEventListener('click', () => {
            handlePathwayClick('GS');
        });

        document.getElementById('control-GNG').addEventListener('click', () => {
            handlePathwayClick('GNG');
        });

        // 新增 Other 按钮的事件监听器
        document.getElementById('control-Other').addEventListener('click', () => {
            handlePathwayClick('Other');
        });
    </script>
</body>
</html>
